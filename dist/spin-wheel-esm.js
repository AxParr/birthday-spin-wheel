/**
 * Spin Wheel (ESM) v2.1.0
 * https://github.com/CrazyTim/spin-wheel#readme
 * Copyright (c) CrazyTim 2022.
 * Distributed under the MIT License.
 */
var b=Math.pow;function R(n=0,t=0){return n=Math.ceil(n),t=Math.floor(t),Math.floor(Math.random()*(t-n))+n}function g(n=0){return n*Math.PI/180}function _(n,t){let e=0;for(let i of n){let o=i[t];o&&(e+=typeof o=="number"?o:1)}return e}function x(n,t,e){return t<e?t<=n&&n<e:t<=n||n<e}function y(n,t,e,i){i.save(),i.font=`1px ${t}`;let o=i.measureText(n).width;return i.restore(),e/o}function I(n={x:0,y:0},t,e,i){return b(n.x-t,2)+b(n.y-e,2)<=b(i,2)}function C(n={x:0,y:0},t={}){let e=t.getBoundingClientRect();return{x:n.x-e.left,y:n.y-e.top}}function S(n,t,e,i){let o=n-e,r=t-i,u=Math.atan2(-r,-o);return u*=180/Math.PI,u<0&&(u+=360),u}function L(n=0,t=0){let e=n+t,i;return e>0?i=e%360:i=360+e%360,i===360&&(i=0),i}function M(n=0,t=0){let e=180-t,i=L(n,e);return 180-i}var c=-90,f=500,p=250,A=Object.freeze({left:"left",right:"right",center:"center"}),s=Object.freeze({borderColor:"#000",borderWidth:0,debug:!1,image:null,isInteractive:!0,itemBackgroundColor:"#fff",itemBackgroundColors:[],itemImage:null,itemImageSize:1,itemImageRadius:.5,itemLabel:"",itemLabelAlign:A.right,itemLabelBaselineOffset:0,itemLabelColor:"#000",itemLabelColors:[],itemLabelFont:"sans-serif",itemLabelFontSizeMax:f,itemLabelRadius:.85,itemLabelRadiusMax:.2,itemLabelRotation:0,itemWeight:1,items:[],lineColor:"#000",lineWidth:1,radius:.95,rotation:0,rotationResistance:-35,rotationSpeed:0,rotationSpeedMax:250,offset:{w:0,h:0},onCurrentIndexChange:null,onRest:null,onSpin:null,overlayImage:null,pointerRotation:0}),v=Object.freeze({pointerLineColor:"#ff00ff",labelOutlineColor:"#ff00ff",dragEventHue:200});function z(n={}){let t=n.canvas;"PointerEvent"in window?(t.addEventListener("pointerdown",o),t.addEventListener("pointermove",e)):(t.addEventListener("touchstart",u),t.addEventListener("mousedown",r),t.addEventListener("mousemove",i));function e(a={}){let l={x:a.clientX,y:a.clientY};n.isCursorOverWheel=n.wheelHitTest(l),n.refreshCursor()}function i(a={}){let l={x:a.clientX,y:a.clientY};n.isCursorOverWheel=n.wheelHitTest(l),n.refreshCursor()}function o(a={}){let l={x:a.clientX,y:a.clientY};if(!n.isInteractive||!n.wheelHitTest(l))return;a.preventDefault(),n.dragStart(l),t.setPointerCapture(a.pointerId),t.addEventListener("pointermove",m),t.addEventListener("pointerup",h),t.addEventListener("pointercancel",h);function m(d={}){d.preventDefault(),n.dragMove({x:d.clientX,y:d.clientY})}function h(d={}){d.preventDefault(),t.releasePointerCapture(d.pointerId),t.removeEventListener("pointermove",m),t.removeEventListener("pointerup",h),t.removeEventListener("pointercancel",h),n.dragEnd()}}function r(a={}){let l={x:a.clientX,y:a.clientY};if(!n.isInteractive||!n.wheelHitTest(l))return;n.dragStart(l),document.addEventListener("mousemove",m),document.addEventListener("mouseup",h);function m(d={}){d.preventDefault(),n.dragMove({x:d.clientX,y:d.clientY})}function h(d={}){d.preventDefault(),document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",h),n.dragEnd()}}function u(a={}){let l={x:a.targetTouches[0].clientX,y:a.targetTouches[0].clientY};if(!n.isInteractive||!n.wheelHitTest(l))return;a.preventDefault(),n.dragStart(l),t.addEventListener("touchmove",m),t.addEventListener("touchend",h),t.addEventListener("touchcancel",h);function m(d={}){d.preventDefault(),n.dragMove({x:d.targetTouches[0].clientX,y:d.targetTouches[0].clientY})}function h(d={}){d.preventDefault(),t.removeEventListener("touchmove",m),t.removeEventListener("touchend",h),t.removeEventListener("touchcancel",h),n.dragEnd()}}}var w=class{constructor(t,e={}){this.canvasContainer=t,this.initCanvas(),this._borderColor=s.borderColor,this._borderWidth=s.borderWidth,this._debug=s.debug,this._image=s.image,this._isInteractive=s.isInteractive,this._itemBackgroundColors=s.itemBackgroundColors,this._itemLabelAlign=s.itemLabelAlign,this._itemLabelBaselineOffset=s.itemLabelBaselineOffset,this._itemLabelColors=s.itemLabelColors,this._itemLabelFont=s.itemLabelFont,this._itemLabelFontSizeMax=s.itemLabelFontSizeMax,this._itemLabelRadius=s.itemLabelRadius,this._itemLabelRadiusMax=s.itemLabelRadiusMax,this._itemLabelRotation=s.itemLabelRotation,this._items=s.items,this._lineColor=s.lineColor,this._lineWidth=s.lineWidth,this._rotationSpeedMax=s.rotationSpeedMax,this._radius=s.radius,this._rotation=s.rotation,this._rotationResistance=s.rotationResistance,this._rotationSpeed=s.rotationSpeed,this._offset=s.offset,this._onCurrentIndexChange=s.onCurrentIndexChange,this._onRest=s.onRest,this._onSpin=s.onSpin,this._overlayImage=s.overlayImage,this._pointerRotation=s.pointerRotation,e&&this.init(e)}initCanvas(){for(;this.canvasContainer.firstChild;)this.canvasContainer.removeChild(this.canvasContainer.firstChild);this.canvas=document.createElement("canvas"),this.canvasContainer.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.registerEvents()}init(t={}){this.borderColor=t.borderColor,this.borderWidth=t.borderWidth,this.debug=t.debug,this.image=t.image,this.isInteractive=t.isInteractive,this.itemBackgroundColors=t.itemBackgroundColors,this.itemLabelAlign=t.itemLabelAlign,this.itemLabelBaselineOffset=t.itemLabelBaselineOffset,this.itemLabelColors=t.itemLabelColors,this.itemLabelFont=t.itemLabelFont,this.itemLabelFontSizeMax=t.itemLabelFontSizeMax,this.itemLabelRadius=t.itemLabelRadius,this.itemLabelRadiusMax=t.itemLabelRadiusMax,this.itemLabelRotation=t.itemLabelRotation,this.items=t.items,this.lineColor=t.lineColor,this.lineWidth=t.lineWidth,this.rotationSpeedMax=t.rotationSpeedMax,this.radius=t.radius,this.rotation=t.rotation,this.rotationResistance=t.rotationResistance,this.rotationSpeed=t.rotationSpeed,this.offset=t.offset,this.onCurrentIndexChange=t.onCurrentIndexChange,this.onRest=t.onRest,this.onSpin=t.onSpin,this.overlayImage=t.overlayImage,this.pointerRotation=t.pointerRotation,this.resize()}registerEvents(){window.addEventListener("resize",()=>this.resize()),z(this)}resize(){window.cancelAnimationFrame(this.frameRequestId);let[t,e]=[this.canvasContainer.clientWidth,this.canvasContainer.clientHeight],i=Math.min(t,e),o={w:i-i*this.offset.w,h:i-i*this.offset.h},r=Math.min(t/o.w,e/o.h);this.size=Math.max(o.w*r,o.h*r),this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.canvas.width=t,this.canvas.height=e,this.center={x:t/2+t*this.offset.w,y:e/2+e*this.offset.h},this.actualRadius=this.size/2*this.radius,this.itemLabelFontSize=this.itemLabelFontSizeMax*(this.size/f),this.labelMaxWidth=this.actualRadius*(this.itemLabelRadius-this.itemLabelRadiusMax);for(let u of this.actualItems)this.itemLabelFontSize=Math.min(this.itemLabelFontSize,y(u.label,this.itemLabelFont,this.labelMaxWidth,this.context));this.frameRequestId=window.requestAnimationFrame(this.draw.bind(this))}draw(t=0){let e=this.context;e.clearRect(0,0,this.canvas.width,this.canvas.height),this.lastFrame===void 0&&(this.lastFrame=t);let i=(t-this.lastFrame)/1e3;i>0&&(this.rotation+=i*this.rotationSpeed,this.rotation=this.rotation%360),this.lastFrame=t;let o=this.getItemAngles(this.rotation),r=this.borderWidth/f*this.size;for(let[a,l]of o.entries())e.beginPath(),e.moveTo(this.center.x,this.center.y),e.arc(this.center.x,this.center.y,this.actualRadius-r/2,g(l.start+c),g(l.end+c)),e.closePath(),e.fillStyle=this.actualItems[a].backgroundColor,e.fill();this.refreshCurrentIndex(o),this.drawItemLines(e,o),this.drawBorder(e),e.textBaseline="middle",e.textAlign=this.itemLabelAlign,e.font=this.itemLabelFontSize+"px "+this.itemLabelFont;let u=this.itemLabelFontSize*-this.itemLabelBaselineOffset;e.save();for(let[a,l]of o.entries()){let m=this.actualItems[a];if(!m.label)continue;e.save();let h=l.start+(l.end-l.start)/2;e.translate(this.center.x+Math.cos(g(h+c))*(this.actualRadius*this.itemLabelRadius),this.center.y+Math.sin(g(h+c))*(this.actualRadius*this.itemLabelRadius)),e.rotate(g(h+c)),this.debug&&(e.beginPath(),e.moveTo(0,0),e.lineTo(-this.labelMaxWidth,0),e.strokeStyle=v.labelOutlineColor,e.lineWidth=1,e.stroke(),e.strokeRect(0,-this.itemLabelFontSize/2,-this.labelMaxWidth,this.itemLabelFontSize)),e.rotate(g(this.itemLabelRotation)),e.fillStyle=m.labelColor,e.fillText(m.label,0,u),e.restore()}this.drawItemImages(e,o),this.drawImage(e,this.image,!1),this.drawImage(e,this.overlayImage,!0),this.drawPointerLine(e),this.drawDragEvents(e),this.applyDrag(i),this.frameRequestId=window.requestAnimationFrame(this.draw.bind(this))}drawItemImages(t,e=[]){for(let[i,o]of e.entries()){let r=this.actualItems[i];if(!r.image||!r.image.complete||r.image.error)continue;t.save();let u=o.start+(o.end-o.start)/2;t.translate(this.center.x+Math.cos(g(u+c))*(this.actualRadius*r.imageRadius),this.center.y+Math.sin(g(u+c))*(this.actualRadius*r.imageRadius)),t.rotate(g(u));let a=this.size/500*r.image.width*r.imageSize,l=this.size/500*r.image.height*r.imageSize,m=-a/2,h=-l/2;t.drawImage(r.image,m,h,a,l),t.restore()}}drawImage(t,e,i=!1){if(!e)return;t.save(),t.translate(this.center.x,this.center.y),i||t.rotate(g(this.rotation));let o=i?this.size:this.size*this.radius,r=-(o/2);t.drawImage(e,r,r,o,o),t.restore()}drawPointerLine(t,e,i=!1){!this.debug||(t.save(),t.translate(this.center.x,this.center.y),t.rotate(g(this.pointerRotation+c)),t.beginPath(),t.moveTo(0,0),t.lineTo(this.actualRadius*2,0),t.strokeStyle=v.pointerLineColor,t.lineWidth=2,t.stroke(),t.restore())}drawBorder(t){let e=this.borderWidth/f*this.size;t.beginPath(),t.strokeStyle=this.borderColor,t.lineWidth=e,t.arc(this.center.x,this.center.y,this.actualRadius-e/2,0,2*Math.PI),t.stroke()}drawItemLines(t,e=[]){if(this.lineWidth<=0)return;let i=this.lineWidth/f*this.size;t.save(),t.translate(this.center.x,this.center.y);for(let[o,r]of e.entries())t.rotate(g(r.start+c)),t.beginPath(),t.moveTo(0,0),t.lineTo(this.actualRadius-i,0),t.strokeStyle=this.lineColor,t.lineWidth=i,t.stroke(),t.rotate(-g(r.start+c));t.restore()}drawDragEvents(){var e;if(!this.debug||!((e=this.dragEvents)==null?void 0:e.length))return;let t=[...this.dragEvents].reverse();for(let[i,o]of t.entries()){let r=i/this.dragEvents.length*100;ctx.beginPath(),ctx.arc(o.x,o.y,5,0,2*Math.PI),ctx.fillStyle=`hsl(${v.dragEventHue},100%,${r}%)`,ctx.strokeStyle="#000",ctx.lineWidth=.5,ctx.fill(),ctx.stroke()}}applyDrag(t=0){var i;if(this.rotationSpeed===0)return;let e=this.rotationSpeed+this.rotationResistance*t*this.rotationDirection;(this.rotationDirection===1&&e<0||this.rotationDirection===-1&&e>=0)&&(e=0),this.rotationSpeed=e,this.rotationSpeed===0&&((i=this.onRest)==null||i.call(this,{event:"rest",currentIndex:this._currentIndex}))}spin(t=0,e=0){var o;let i=e/2;this.rotationSpeed=R(t*(1-i),t*(1+i)),this.rotationSpeed!==0&&((o=this.onSpin)==null||o.call(this,{event:"spin",direction:this.rotationDirection,rotationSpeed:this.rotationSpeed}))}getRotationDirection(t=0){return t>0?1:-1}wheelHitTest(t={x:0,y:0}){let e=C(t,this.canvas);return I(e,this.center.x,this.center.y,this.actualRadius)}refreshCursor(){if(this.isDragging){this.canvas.style.cursor="grabbing";return}if(this.isInteractive&&this.isCursorOverWheel){this.canvas.style.cursor="grab";return}this.canvas.style.cursor=null}processItems(){this.actualItems=[];for(let[t,e]of this.items.entries()){let i={};typeof e.backgroundColor=="string"?i.backgroundColor=e.backgroundColor:this.itemBackgroundColors.length?i.backgroundColor=this.itemBackgroundColors[t%this.itemBackgroundColors.length]:i.backgroundColor=s.itemBackgroundColor,typeof e.label=="string"?i.label=e.label:i.label=s.itemLabel,typeof e.labelFont=="string"?i.labelFont=e.labelFont:i.labelFont=this.itemLabelFont,typeof e.labelColor=="string"?i.labelColor=e.labelColor:this.itemLabelColors.length?i.labelColor=this.itemLabelColors[t%this.itemLabelColors.length]:i.labelColor=s.itemLabelColor,typeof e.weight=="number"?i.weight=e.weight:i.weight=s.itemWeight,typeof e.image=="string"?(i.image=new Image,i.image.src=e.image,i.image.onerror=o=>(i.image.error=!0,!0)):i.image=s.itemImage,typeof e.imageSize=="number"?i.imageSize=e.imageSize:i.imageSize=s.itemImageSize,typeof e.imageRadius=="number"?i.imageRadius=e.imageRadius:i.imageRadius=s.itemImageRadius,this.actualItems.push(i)}this.actualItems.length?this.weightedItemAngle=360/_(this.actualItems,"weight"):this.weightedItemAngle=0}getAngleFromCenter(t={x:0,y:0}){return(S(this.center.x,this.center.y,t.x,t.y)+90)%360}getCurrentIndex(){return this._currentIndex}refreshCurrentIndex(t=[]){var e;for(let[i,o]of t.entries())if(!!x(this.pointerRotation,o.start%360,o.end%360)){if(this._currentIndex===i)break;this._currentIndex=i,(e=this.onCurrentIndexChange)==null||e.call(this,{event:"CurrentIndexChange",currentIndex:this._currentIndex})}}getItemAngles(t=0){let e=[],i,o=t;for(let r of this.actualItems)i=r.weight*this.weightedItemAngle,e.push({start:o,end:o+i}),o+=i;return e}get borderColor(){return this._borderColor}set borderColor(t){typeof t=="string"?this._borderColor=t:this._borderColor=s.borderColor}get borderWidth(){return this._borderWidth}set borderWidth(t){typeof t=="number"?this._borderWidth=t:this._borderWidth=s.borderWidth}get debug(){return this._debug}set debug(t){typeof t=="boolean"?this._debug=t:this._debug=s.debug}get image(){return this._image}set image(t){typeof t=="string"?(this._image=new Image,this._image.src=t):this._image=s.image}get isInteractive(){return this._isInteractive}set isInteractive(t){typeof t=="boolean"?this._isInteractive=t:this._isInteractive=s.isInteractive}get itemBackgroundColors(){return this._itemBackgroundColors}set itemBackgroundColors(t){Array.isArray(t)?this._itemBackgroundColors=t:this._itemBackgroundColors=s.itemBackgroundColors,this.processItems()}get itemLabelAlign(){return this._itemLabelAlign}set itemLabelAlign(t){typeof t=="string"?this._itemLabelAlign=t:this._itemLabelAlign=s.itemLabelAlign}get itemLabelBaselineOffset(){return this._itemLabelBaselineOffset}set itemLabelBaselineOffset(t){typeof t=="number"?this._itemLabelBaselineOffset=t:this._itemLabelBaselineOffset=s.itemLabelBaselineOffset,this.resize()}get itemLabelColors(){return this._itemLabelColors}set itemLabelColors(t){Array.isArray(t)?this._itemLabelColors=t:this._itemLabelColors=s.itemLabelColors,this.processItems()}get itemLabelFont(){return this._itemLabelFont}set itemLabelFont(t){typeof t=="string"?this._itemLabelFont=t:this._itemLabelFont=s.itemLabelFont,this.resize()}get itemLabelFontSizeMax(){return this._itemLabelFontSizeMax}set itemLabelFontSizeMax(t){typeof t=="number"?this._itemLabelFontSizeMax=t:this._itemLabelFontSizeMax=s.itemLabelFontSizeMax}get itemLabelRadius(){return this._itemLabelRadius}set itemLabelRadius(t){typeof t=="number"?this._itemLabelRadius=t:this._itemLabelRadius=s.itemLabelRadius}get itemLabelRadiusMax(){return this._itemLabelRadiusMax}set itemLabelRadiusMax(t){typeof t=="number"?this._itemLabelRadiusMax=t:this._itemLabelRadiusMax=s.itemLabelRadiusMax}get itemLabelRotation(){return this._itemLabelRotation}set itemLabelRotation(t){typeof t=="number"?this._itemLabelRotation=t:this._itemLabelRotation=s.itemLabelRotation}get items(){return this._items}set items(t){Array.isArray(t)?this._items=t:this._items=s.items,this.processItems()}get lineColor(){return this._lineColor}set lineColor(t){typeof t=="string"?this._lineColor=t:this._lineColor=s.lineColor}get lineWidth(){return this._lineWidth}set lineWidth(t){typeof t=="number"?this._lineWidth=t:this._lineWidth=s.lineWidth}get radius(){return this._radius}set radius(t){typeof t=="number"?this._radius=t:this._radius=s.radius,this.resize()}get rotation(){return this._rotation}set rotation(t){typeof t=="number"?this._rotation=t:this._rotation=s.rotation}get rotationResistance(){return this._rotationResistance}set rotationResistance(t){typeof t=="number"?this._rotationResistance=t:this._rotationResistance=s.rotationResistance}get rotationSpeed(){return this._rotationSpeed}set rotationSpeed(t){if(typeof t=="number"){let e=Math.min(t,this.rotationSpeedMax);e=Math.max(e,-this.rotationSpeedMax),this.rotationDirection=this.getRotationDirection(e),this._rotationSpeed=e}else this.rotationDirection=0,this._rotationSpeed=s.rotationSpeed}get rotationSpeedMax(){return this._rotationSpeedMax}set rotationSpeedMax(t){typeof t=="number"?this._rotationSpeedMax=t:this._rotationSpeedMax=s.rotationSpeedMax}get offset(){return this._offset}set offset(t){t?this._offset=t:this._offset=s.offset,this.resize()}get onCurrentIndexChange(){return this._onCurrentIndexChange}set onCurrentIndexChange(t){typeof t=="function"?this._onCurrentIndexChange=t:this._onCurrentIndexChange=s.onCurrentIndexChange}get onRest(){return this._onRest}set onRest(t){typeof t=="function"?this._onRest=t:this._onRest=s.onRest}get onSpin(){return this._onSpin}set onSpin(t){typeof t=="function"?this._onSpin=t:this._onSpin=s.onSpin}get overlayImage(){return this._overlayImage}set overlayImage(t){typeof t=="string"?(this._overlayImage=new Image,this._overlayImage.src=t):this._overlayImage=s.overlayImage}get pointerRotation(){return this._pointerRotation}set pointerRotation(t){typeof t=="number"?this._pointerRotation=t:this._pointerRotation=s.pointerRotation}dragStart(t={x:0,y:0}){let e=C(t,this.canvas),i=-this.getAngleFromCenter(e);this.isDragging=!0,this.rotationSpeed=0,this.dragStartRotation=L(i,this.rotation),this.dragEvents=[{distance:0,x:e.x,y:e.y,now:performance.now()}],this.refreshCursor()}dragMove(t={x:0,y:0}){let e=C(t,this.canvas),i=this.getAngleFromCenter(e),o=this.dragEvents[0],r=this.getAngleFromCenter(o),u=M(r,i);this.dragEvents.unshift({distance:u,x:e.x,y:e.y,now:performance.now()}),this.debug&&this.dragEvents.length>=40&&this.dragEvents.pop(),this.rotation=L(i,this.dragStartRotation)}dragEnd(){var i;this.isDragging=!1,clearInterval(this.dragClearOldDistances);let t=0,e=performance.now();for(let[o,r]of this.dragEvents.entries()){if(!this.isDragEventTooOld(e,r)){t+=r.distance;continue}this.dragEvents.length=o;break}t!==0&&(this.rotationSpeed=t*(1e3/p),(i=this.onSpin)==null||i.call(this,{event:"spin",rotationDirection:this.rotationDirection,rotationSpeed:this.rotationSpeed,dragEvents:[...this.dragEvents]})),this.refreshCursor()}isDragEventTooOld(t,e={}){return t-e.now>p}};export{w as Wheel};
